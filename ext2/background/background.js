import{AchiCaptcha}from"../common/api.js";import{chrome}from"../browser_bg.js";import{Config}from"../common/config.js";let API;async function init(){var e;void 0===API&&(e=await Config.getAll()).clientKey&&initApiClient(e.clientKey)}function initApiClient(e){API=new AchiCaptcha({clientKey:e})}self.popup_getConfig=async function(){return Config.getAll()},self.popup_setConfig=async function(e){return Config.set(e.key,e.value)},self.popup_checkClientKey=async function(e){return initApiClient(e.clientKey),API.checkClientKey()},self.content_solve=async function(e){return API[e.captchaType](e.params)},chrome.runtime.onMessage.addListener((n,e,s)=>(init().then(()=>{var e,t;return"recaptcha_submit_token"===n.task?.type?(t=(e=n.task).type,API[t](e).then(e=>{s({message:"success",result:e})}).catch(e=>{s({message:"error",result:e})})):"recaptcha_image"===n.task?.type?(e=(t=n.task).type,API[e](t).then(e=>{s({message:"success",result:e})}).catch(e=>{s({message:"error",result:e})})):"HCaptchaImageTask"===n.task?.type?(t=(e=n.task).type,API[t](e).then(e=>{s({message:"success",result:e})}).catch(e=>{s({message:"error",result:e})})):(t=n.name+"_"+n.action,void 0!==self[t]&&self[t](n).then(e=>{s({action:n.action,request:n,response:e})}).catch(e=>{s({action:n.action,request:n,error:e.message})})),!0}),!0));
