function simulateDragV2(r,i){return new Promise(n=>{var e=new DragEvent("dragstart",{bubbles:!0,clientX:0,clientY:8}),a=(r.dispatchEvent(e),0),c=1;!function e(){a+=1;var t=new DragEvent("drag",{bubbles:!0,clientX:a,clientY:8}),t=(r.dispatchEvent(t),document.querySelector(".cap-flex.cap-absolute"));parseInt(t.style.transform.split("(")[1].split("px")[0])<i?setTimeout(e,c):(t=new DragEvent("dragend",{bubbles:!0}),r.dispatchEvent(t),n())}()})}CaptchaProcessors.register({captchaType:"tiktok",canBeProcessed:function(e,t){return!!$("#"+e.containerId).length},attachButton:function(e,t,n){e=$("#"+e.containerId);n.css({width:e.find("iframe").outerWidth()+"px"}),e.append(n),t.tiktok_auto_solve&&n.click()},getParams:function(e,t){return e},onSolved:async function(t,a){if(document.querySelector(".captcha_verify_message"))document.querySelector(".secsdk_captcha_refresh--text")?.click(),await new Promise(e=>setTimeout(e,2e3));else if(2===parseInt(t.subType)){var[c,r,e,n]=a.split(",").splice(0,4),i=document.querySelector("#captcha-verify-image")||document.querySelector(".cap-rounded-lg"),u=i.getBoundingClientRect(),o=i.width,l=i.height,c=parseInt(c)*o/i.naturalWidth,r=parseInt(r)*l/i.naturalHeight,e=parseInt(e)*o/i.naturalWidth,n=parseInt(n)*l/i.naturalHeight,o=u.left,l=u.top,u=(i.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0,clientX:o+c,clientY:l+r})),await new Promise(e=>setTimeout(e,510)),i.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0,clientX:o+e,clientY:l+n})),await new Promise(e=>setTimeout(e,1e3)),document.querySelector(".verify-captcha-submit-button"));u?u.click():document.querySelector('[class*="captcha-verify-container"] .TUXButton-label')?document.querySelector('[class*="captcha-verify-container"] .TUXButton-label').click():document.evaluate("//*[text()='Confirm']|//*[text()='Xác nhận']",document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null)?.singleNodeValue?.click(),await new Promise(e=>setTimeout(e,3e3+2e3*Math.random()))}else if(0===parseInt(t.subType)||1===parseInt(t.subType)||6===parseInt(t.subType)){let e,n;if(0===parseInt(t.subType)){c=(document.querySelector(".captcha_verify_slide--slidebar")||document.querySelector(".cap-rounded-full")).clientWidth,r=(document.querySelector(".cap-rounded-full .cap-absolute")||document.querySelector(".secsdk-captcha-drag-icon")).clientWidth;n=c-r,e=parseInt(a)/1.5262201462308829*(c-r)/180}else{n=310;try{var s=document.querySelector("#captcha-verify-image");e=parseInt(a)*s.clientWidth/s.naturalWidth,e=Math.round(e)-8}catch{return void resetCaptchaWidget(t.captchaType,t.widgetId)}}var d=document.querySelector(".captcha_verify_img_slide")||document.querySelector(".cap-rounded-full .cap-absolute")||document.querySelector(".secsdk-captcha-drag-icon");if(document.querySelector(".cap-rounded-full .cap-absolute"))await simulateDragV2(document.querySelector(".cap-rounded-full .cap-absolute"),e);else{d.dispatchEvent(new FocusEvent("focus",{bubbles:!0})),d.dispatchEvent(new MouseEvent("mouseover",{bubbles:!0,clientX:0,clientY:0})),d.dispatchEvent(new MouseEvent("mousedown",{bubbles:!0,clientX:0,clientY:0}));for(var p of Array.from({length:n},(e,t)=>t/n))d.dispatchEvent(new MouseEvent("mousemove",{bubbles:!0,clientX:e*p,clientY:Math.round(10*Math.random())})),await new Promise(e=>setTimeout(e,1));await new Promise(e=>setTimeout(e,500)),d.dispatchEvent(new MouseEvent("mouseup",{bubbles:!0,clientX:e,clientY:0})),d.dispatchEvent(new MouseEvent("mouseout",{bubbles:!0,clientX:e,clientY:0})),d.dispatchEvent(new FocusEvent("blur",{bubbles:!0}))}await new Promise(e=>setTimeout(e,3e3+2e3*Math.random()))}else if(5===parseInt(t.subType)){var m=a.split(",");for(let e=0;e<m.length;e+=2){var h=parseInt(m[e]),b=parseInt(m[e+1]),v=document.querySelector('[alt="Verify that you’re not a robot"]')||document.querySelector("#captcha-verify-image"),y=v.getBoundingClientRect(),f=v.width,w=v.height,h=h*f/v.naturalWidth,b=b*w/v.naturalHeight,f=y.left;v.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0,clientX:f+h,clientY:y.top+b})),await new Promise(e=>setTimeout(e,1e3))}document.evaluate("//*[text()='Confirm']|//*[text()='Xác nhận']",document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null)?.singleNodeValue?.click(),await new Promise(e=>setTimeout(e,3e3+2e3*Math.random()))}resetCaptchaWidget(t.captchaType,t.widgetId)},onFail:async function(e){document.querySelector("#refresh-button")?.click(),document.querySelector("div.cap-flex-row button")?.click(),await new Promise(e=>setTimeout(e,2e3)),resetCaptchaWidget(e.captchaType,e.widgetId)},getForm:function(e){return!1},getCallback:function(e){return null}});
