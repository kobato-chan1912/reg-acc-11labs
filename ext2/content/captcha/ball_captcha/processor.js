window.subtractAndFindMaxContour=async(t,e,a={})=>{var n=a.diffThreshold??10;let r=a.areaThreshold??10;function i(n){return new Promise((t,e)=>{let a=new Image;a.onload=()=>t(a),a.onerror=()=>e(new Error("Failed to load image")),a.src=n})}function o(t,e){var a=document.createElement("canvas");return a.width=t,a.height=e,a}a=await i(t),t=await i(e);let c=a.width,l=a.height;e=o(c,l).getContext("2d");e.drawImage(a,0,0,c,l);var a=o(c,l).getContext("2d"),m=(a.drawImage(t,0,0,c,l),e.getImageData(0,0,c,l).data),s=a.getImageData(0,0,c,l).data,t=o(c,l),e=t.getContext("2d"),u=e.createImageData(c,l),d=new Uint8Array(c*l);for(let t=0,e=0;t<m.length;t+=4,e++){var h=m[t],x=m[t+1],w=m[t+2],b=s[t],f=s[t+1],g=s[t+2],h=Math.abs(h-b)+Math.abs(x-f)+Math.abs(w-g),b=Math.round(h/3);u.data[t]=b,u.data[t+1]=b,u.data[t+2]=b,u.data[t+3]=255,d[e]=n<=b?1:0}e.putImageData(u,0,0);a=((r,i,o)=>{var c=new Uint8Array(i*o),l=[],m=new Uint32Array(i*o),s=new Uint32Array(i*o);for(let n=0;n<o;n++)for(let a=0;a<i;a++){var u=n*i+a;if(0!==r[u]&&!c[u]){let t=0,e=0;m[e]=a,s[e]=n,e++,c[u]=1;for(var d=[];t<e;){var h=m[t],x=s[t],w=(t++,d.push({x:h,y:x}),[[h-1,x],[h+1,x],[h,x-1],[h,x+1]]);for(let t=0;t<4;t++){var b,f=w[t][0],g=w[t][1];f<0||i<=f||g<0||o<=g||c[b=g*i+f]||0===r[b]||(c[b]=1,m[e]=f,s[e]=g,e++)}}l.push(d)}}return l})(d,c,l).filter(t=>t.length>=r);if(0===a.length)return{diffDataUrl:t.toDataURL(),annotatedDataUrl:t.toDataURL(),width:c,height:l,boxes:[]};a.sort((t,e)=>e.length-t.length);var v,e=a.slice(0,2).map(t=>{let e=c,a=l,n=0,r=0;for(var i of t)i.x<e&&(e=i.x),i.y<a&&(a=i.y),i.x>n&&(n=i.x),i.y>r&&(r=i.y);return{xmin:Math.round(e),ymin:Math.round(a),xmax:Math.round(n),ymax:Math.round(r),area:t.length}}),a=o(c,l),p=a.getContext("2d");p.drawImage(t,0,0),p.strokeStyle="red",p.lineWidth=2;for(v of e)p.strokeRect(v.xmin,v.ymin,v.xmax-v.xmin,v.ymax-v.ymin);return{diffDataUrl:t.toDataURL(),annotatedDataUrl:a.toDataURL(),width:c,height:l,boxes:e}},window.calcIOU=(t,e)=>{var a,n,r,i;return!t||!e||(i=Math.max(t.xmin,e.xmin),a=Math.max(t.ymin,e.ymin),r=Math.min(t.xmax,e.xmax),n=Math.min(t.ymax,e.ymax),r=Math.max(0,r-i)*Math.max(0,n-a),0==(i=Math.max(0,t.xmax-t.xmin)*Math.max(0,t.ymax-t.ymin)+Math.max(0,e.xmax-e.xmin)*Math.max(0,e.ymax-e.ymin)-r))?0:r/i},CaptchaProcessors.register({captchaType:"ball_captcha",canBeProcessed:function(t,e){return!!$("#"+t.containerId).length},attachButton:function(t,e,a){t=$("#"+t.containerId);a.css({width:t.find("iframe").outerWidth()+"px"}),t.append(a),e.textcaptcha_auto_solve&&a.click()},getParams:function(t,e){return t},onSolved:async function(t,e){var[a,n,r,i]=e.split(","),a=parseInt(a),n=parseInt(n),r=parseInt(r),i=parseInt(i),o=document.querySelector("#huntCaptcha canvas"),e=o.getBoundingClientRect(),c=e.left+e.width/2,e=e.top+e.height-10,l=o.toDataURL();o.dispatchEvent(new MouseEvent("mousedown",{bubbles:!0,cancelable:!0,clientX:c,clientY:e}));let m=c,s=e,u=!1;for(let t=25;0<t;t--){m-=5,s+=0,o.dispatchEvent(new MouseEvent("mousemove",{bubbles:!0,cancelable:!0,clientX:m,clientY:s})),await new Promise(t=>setTimeout(t,10));var d,h=o.toDataURL(),h=(await subtractAndFindMaxContour(l,h)).boxes;for(d of h){var x=calcIOU(d,{xmin:a,ymin:n,xmax:r,ymax:i});if(.5<x){u=!0;break}}if(u)break;await new Promise(t=>setTimeout(t,20))}if(!u)for(let t=0;t<50;t++){m+=5,s+=0,o.dispatchEvent(new MouseEvent("mousemove",{bubbles:!0,cancelable:!0,clientX:m,clientY:s})),await new Promise(t=>setTimeout(t,10));var w,b=o.toDataURL(),b=(await subtractAndFindMaxContour(l,b)).boxes;for(w of b){var f=calcIOU(w,{xmin:a,ymin:n,xmax:r,ymax:i});if(.5<f){u=!0;break}}if(u)break}o.dispatchEvent(new MouseEvent("mouseup",{bubbles:!0,cancelable:!0,clientX:m,clientY:s})),await new Promise(t=>setTimeout(t,5e3)),resetCaptchaWidget(t.captchaType,t.widgetId)},onFail:async function(t){var e=document.querySelector("#huntCaptcha canvas"),a=e.getBoundingClientRect(),n=a.left+a.width/2,a=a.top+a.height-10;e.dispatchEvent(new MouseEvent("mousedown",{bubbles:!0,cancelable:!0,clientX:n,clientY:a})),e.dispatchEvent(new MouseEvent("mousemove",{bubbles:!0,cancelable:!0,clientX:n+20,clientY:a})),e.dispatchEvent(new MouseEvent("mouseup",{bubbles:!0,cancelable:!0,clientX:n,clientY:a})),await new Promise(t=>setTimeout(t,5e3)),resetCaptchaWidget(t.captchaType,t.widgetId)},getForm:function(t){return!1},getCallback:function(t){return null}});
