import{StatusCode}from"./status_code.js";class AchiCaptcha{constructor(t){var e,a={clientKey:"",service:"https://api.achicaptcha.com",defaultTimeout:120,pollingInterval:3};for(e in a)this[e]=(void 0===t[e]?a:t)[e];this.endpoints={createTaskApi:this.service+"/createTask",getTaskResultApi:this.service+"/getTaskResult",checkClientKey:this.service+"/checkClientKey"}}async checkClientKey(){var e={method:"POST",headers:{"Content-Type":"application/json"}};let t={};t.clientKey=this.clientKey,t=JSON.stringify(t),e.body=t;let a;for(let t=0;t<10;t++){try{(a=await(await fetch(this.endpoints.checkClientKey,e)).json()).errorId=parseInt(a.errorId);break}catch(t){await new Promise(t=>setTimeout(t,1e3));continue}throw new Error("API_CONNECTION_ERROR")}if(0!==a.errorId)throw new Error(a.errorDescription);return a}async toDataURL(t){return fetch(t).then(t=>t.blob()).then(i=>new Promise((t,e)=>{let a=new FileReader;a.onloadend=()=>t(a.result),a.onerror=e,a.readAsDataURL(i)}))}async bytedance_captcha(t){var e;let a=[];for(e of t.main.split("|")){var i=await this.toDataURL(e);a.push(i)}var s={type:"TiktokCaptchaTask",image:a=a.join("|"),subType:t.subType},t=(""!==t.other&&(s.other=t.other),await this.solve(s,{timeout:60}));return t.solution}async tiktok(t){var e={type:"TiktokCaptchaTask",image:t.main,subType:t.subType},t=(""!==t.other&&(e.other=t.other),await this.solve(e,{timeout:60}));return t.solution}async hcaptcha_image(t){t={type:"HCaptchaImageTask",image:t.main,subType:t.subType,other:t.other};return(await this.solve(t,{timeout:60})).solution}async xblast(t){t={type:"TiktokCaptchaTask",image:t.main,subType:t.subType};return(await this.solve(t,{timeout:60})).solution}async geetest_captcha(t){var e=t.main.split("|");let a=[];if(t.main.includes("base64"))a=t.main;else{for(var i of e){i=await this.toDataURL(i);a.push(i)}a=a.join("|")}let s;t.isSlide?s="TiktokCaptchaTask":3===t.subType?s="GeetestImageCaptchaTask":"GridCaptcha"===t.type&&(s="GridCaptcha");e={type:s,image:a,subType:t.subType},void 0!==t.other&&(e.other=t.other),t=await this.solve(e,{timeout:60});return t.solution}async kling_captcha(t){var e=t.main.split("|");let a=[];if(t.main.includes("base64"))a=t.main;else{for(var i of e){i=await this.toDataURL(i);a.push(i)}a=a.join("|")}e={type:"SlideCaptchaTask",image:a,subType:t.subType},void 0!==t.other&&(e.other=t.other),t=await this.solve(e,{timeout:60});return t.solution}async tencent_captcha(t){var e=t.main.split("|");let a=[];if(t.main.includes("base64"))a=t.main;else{for(var i of e){i=await this.toDataURL(i);a.push(i)}a=a.join("|")}e={type:"TiktokCaptchaTask",image:a,subType:t.subType},void 0!==t.other&&(e.other=t.other),t=await this.solve(e,{timeout:60});return t.solution}async geetest_captcha_3icons(t){var e=t.main.split("|");let a=[];if(t.main.includes("base64"))a=t.main;else{for(var i of e){i=await this.toDataURL(i);a.push(i)}a=a.join("|")}let s;t.isSlide?s="TiktokCaptchaTask":3===t.subType?s="GeetestImageCaptchaTask":"GridCaptcha"===t.type&&(s="GridCaptcha");e={type:s,image:a,subType:t.subType},void 0!==t.other&&(e.other=t.other),t=await this.solve(e,{timeout:60});return t.solution}async geetest_captcha_icon(t){var e=t.main.split("|");let a=[];if(t.main.includes("base64"))a=t.main;else{for(var i of e){i=await this.toDataURL(i);a.push(i)}a=a.join("|")}let s;t.isSlide?s="TiktokCaptchaTask":"3"===t.subType&&(s="GeetestImageCaptchaTask");e={type:s,image:a,subType:t.subType},void 0!==t.other&&(e.other=t.other),t=await this.solve(e,{timeout:60});return t.solution}async geetest_captcha_obj_direction(t){var e=t.main.split("|");let a=[];if(t.main.includes("base64"))a=t.main;else{for(var i of e){i=await this.toDataURL(i);a.push(i)}a=a.join("|")}e={type:"GeetestImageCaptchaTask",image:a,subType:t.subType},void 0!==t.other&&(e.other=t.other),t=await this.solve(e,{timeout:60});return t.solution}async geetest_captcha_icon_order(t){var e=t.main.split("|");let a=[];if(t.main.includes("base64"))a=t.main;else{for(var i of e){i=await this.toDataURL(i);a.push(i)}a=a.join("|")}e={type:"GeetestImageCaptchaTask",image:a,subType:t.subType},void 0!==t.other&&(e.other=t.other),t=await this.solve(e,{timeout:60});return t.solution}async geetest_v3_icon_order(t){var e=t.main.split("|");let a=[];if(t.main.includes("base64"))a=t.main;else{for(var i of e){i=await this.toDataURL(i);a.push(i)}a=a.join("|")}e={type:"GeetestImageCaptchaTask",image:a,subType:t.subType},void 0!==t.other&&(e.other=t.other),t=await this.solve(e,{timeout:60});return t.solution}async geetest_captcha_crawl(t){var e=t.main.split("|");let a=[];if(t.main.includes("base64"))a=t.main;else{for(var i of e){i=await this.toDataURL(i);a.push(i)}a=a.join("|")}e={type:"GeetestImageCrawlTask",image:a,subType:t.subType};return(await this.solve(e,{timeout:60})).solution}async geetest_icon(t){var e=t.main.split("|");let a=[];if(t.main.includes("base64"))a=t.main;else{for(var i of e){i=await this.toDataURL(i);a.push(i)}a=a.join("|")}e={type:"GeetestTask",image:a,subType:t.subType};return(await this.solve(e,{timeout:60})).solution}async geetest_captcha_2(t){var e=t.main.split("|");let a=[];if(t.main.includes("base64"))a=t.main;else{for(var i of e){i=await this.toDataURL(i);a.push(i)}a=a.join("|")}let s;t.isSlide?(s="TiktokCaptchaTask","bingx"===t.site&&(s="SlideCaptchaTask")):s="GeetestOneIcon";e={type:s,image:a,subType:t.subType};return(await this.solve(e,{timeout:60})).solution}async yidun_captcha(t){var e;let a=[];for(e of t.main.split("|")){var i=await this.toDataURL(e);a.push(i)}t={type:"SlideCaptchaTask",image:a=a.join("|"),subType:t.subType};return(await this.solve(t,{timeout:60})).solution}async slider_captcha(t){var e;let a=[];for(e of t.main.split("|")){var i=await this.toDataURL(e);a.push(i)}t={type:"SlideCaptchaTask",image:a=a.join("|"),subType:t.subType};return(await this.solve(t,{timeout:60})).solution}async slider_dx_captcha(t){var e;let a=[];for(e of t.main.split("|")){var i=await this.toDataURL(e);a.push(i)}t={type:"SlideCaptchaTask",image:a=a.join("|"),subType:t.subType};return(await this.solve(t,{timeout:60})).solution}async klook_captcha(t){var e=t.main;return(await this.solve({type:"SlideCaptchaTask",image:e,subType:t.subType},{timeout:60})).solution}async wave_captcha(t){var e=t.main;return(await this.solve({type:"SlideCaptchaTask",image:e,subType:t.subType},{timeout:60})).solution}async upsidedown(t){var e=t.main;return(await this.solve({type:"UpsideDownCaptchaTask",image:e,subType:t.subType},{timeout:60})).solution}async livechamp(t){var e=t.main;return(await this.solve({type:"SliderTwoMark",image:e,subType:t.subType},{timeout:60})).solution}async shopee(t){t={type:"ShopeeCaptchaTask",image:t.main,subType:t.subType};return(await this.solve(t,{timeout:60})).solution}async zalo_captcha(t){t={type:"GridCaptcha",image:await this.toDataURL(t.main),subType:t.subType,other:t.other};return(await this.solve(t,{timeout:60})).solution}async bybit(t){var e=t.main;return(await this.solve({type:"SlideCaptchaTask",image:e,subType:t.subType},{timeout:60})).solution}async bybit_slider_v2(t){var e;let a=[];for(e of t.main.split("|")){var i=await this.toDataURL(e);a.push(i)}t={type:"TiktokCaptchaTask",image:a=a.join("|"),subType:1};return(await this.solve(t,{timeout:60})).solution}async wephoneapp(t){var e;let a=[];for(e of t.main.split("|")){var i=await this.toDataURL(e);a.push(i)}t={type:"SlideCaptchaTask",image:a=a.join("|"),subType:1};return(await this.solve(t,{timeout:60})).solution}async mk_slider(t){var e;let a=[];for(e of t.main.split("|")){var i=await this.toDataURL(e);a.push(i)}t={type:"TiktokCaptchaTask",image:a=a.join("|"),subType:1};return(await this.solve(t,{timeout:60})).solution}async geetest_v3(t){var e;let a=[];for(e of t.main.split("|")){var i=await this.toDataURL(e);a.push(i)}t={type:"SlideCaptchaTask",image:a=a.join("|"),subType:1};return(await this.solve(t,{timeout:60})).solution}async tc_captcha(t){var e;let a=[];for(e of t.main.split("|")){var i=await this.toDataURL(e);a.push(i)}t={type:"SlideCaptchaTask",image:a=a.join("|"),subType:1};return(await this.solve(t,{timeout:60})).solution}async tc_captcha_icon(t){var e;let a=[];for(e of t.main.split("|")){var i=await this.toDataURL(e);a.push(i)}t={type:"GeetestImageCaptchaTask",image:a=a.join("|"),subType:"TcapchaIcon"};return(await this.solve(t,{timeout:60})).solution}async tc_captcha_grid(t){var e;let a=[];for(e of t.main.split("|")){var i=await this.toDataURL(e);a.push(i)}t={type:"GridCaptcha",image:a=a.join("|"),subType:"tc",other:t.other};return(await this.solve(t,{timeout:60})).solution}async vietjet_captcha(t){var e;let a=[];for(e of t.main.split("|")){let t=e;e.includes("base64")||(t=await this.toDataURL(e)),a.push(t)}t={type:"SlideCaptchaTask",image:a=a.join("|"),subType:1};return(await this.solve(t,{timeout:60})).solution}async vz684(t){t={type:"ImageToTextTask",image:t.main,subType:"11166"};return(await this.solve(t,{timeout:60})).solution}async svg(t){t={type:"ImageToTextTask",image:t.main,subType:"svg"};return(await this.solve(t,{timeout:60})).solution}async okvip_text(t){t={type:"ImageToTextTask",image:t.main,subType:"okvip",other:t.other};return(await this.solve(t,{timeout:60})).solution}async imageUrlToBase64Blob(t){return new Promise((a,e)=>{fetch(t).then(t=>t.blob()).then(t=>{var e=new FileReader;e.onload=function(){var t=e.result.split(",")[1];a(t)},e.readAsDataURL(t)}).catch(t=>{e(t)})})}async funcaptcha(t){t={type:"FuncaptchaImageTask",image:t.main,subType:t.subType,other:t.other};return(await this.solve(t,{timeout:60})).solution}async funcaptcha_crawler(t){t={type:"FuncaptchaCrawlTask",image:t.main,subType:0,other:t.other};return(await this.solve(t,{timeout:60})).solution}async bytedance_crawler(t){var e;let a=[];for(e of t.main.split("|")){var i=await this.toDataURL(e);a.push(i)}t={type:"ByteDanceCrawlTask",image:a=a.join("|"),subType:0,other:t.other};return(await this.solve(t,{timeout:60})).solution}async temu_crawl(t){t={type:"ImageToTextTask",image:t.main,subType:"temu",other:t.other};return(await this.solve(t,{timeout:60})).solution}async shopee_text(t){t={type:"ImageToTextTask",image:t.main,subType:"shopee"};return(await this.solve(t,{timeout:60})).solution}async facebook_text(t){t={type:"ImageToTextTask",image:t.main,subType:"facebook"};return(await this.solve(t,{timeout:60})).solution}async be_text(t){t={type:"ImageToTextTask",image:t.main,subType:"common"};return(await this.solve(t,{timeout:60})).solution}async rotate_captcha(t){t={type:"RotateCaptchaImageTask",image:t.main,subType:"0"};return(await this.solve(t,{timeout:60})).solution}async ball_captcha(t){t={type:"BallCaptchaImageTask",image:t.main,subType:"0"};return(await this.solve(t,{timeout:60})).solution}async amazon_text(t){t=await this.toDataURL(t.main);return(await this.solve({type:"ImageToTextTask",image:t,subType:"common"},{timeout:60})).solution}async amazon_grid(t){var e=t.main;return(await this.solve({type:"GridCaptcha",subType:"amzn",other:t.question,image:e},{timeout:60})).solution}async mova_grid(t){var e=t.main;return(await this.solve({type:"GridCaptcha",subType:"amzn",other:t.question,image:e},{timeout:60})).solution}async apple_text(t){t=await this.toDataURL(t.main);return(await this.solve({type:"ImageToTextTask",image:t,subType:"apple"},{timeout:60})).solution}async st_text(t){let e=t.main;t={type:"ImageToTextTask",image:e=t.main.includes("base64")?e:await this.toDataURL(t.main),subType:"common"};return(await this.solve(t,{timeout:60})).solution}async common_text(t){let e=t.main;t={type:"ImageToTextTask",image:e=t.main.includes("base64")?e:await this.toDataURL(t.main),subType:"common"};return(await this.solve(t,{timeout:60})).solution}async faucet_icon_captcha(t){t={type:"FaucetCaptchaTask",image:t.main,subType:"icon"};return(await this.solve(t,{timeout:60})).solution}async discord_text(t){let e=t.main;t={type:"ImageToTextTask",image:e=t.main.includes("base64")?e:await this.toDataURL(t.main),subType:"common"};return(await this.solve(t,{timeout:60})).solution}async tele_text(t){t=t.main;return(await this.solve({type:"ImageToTextTask",image:t,subType:"telegram"},{timeout:60})).solution}async google_text(t){t=await this.toDataURL(t.main);return(await this.solve({type:"ImageToTextTask",image:t,subType:"common"},{timeout:60})).solution}async socolivelk_text(t){t=t.main;return(await this.solve({type:"ImageToTextTask",image:t,subType:"common"},{timeout:60})).solution}async binance_geetest(t){t={type:"GeetestTask",image:t.main,subType:t.subType,other:t.nGrid+"|"+t.typeObject};return(await this.solve(t,{timeout:60})).solution}async recaptcha_image(t){t={type:"ReCaptchaImageTask",other:t.other};return(await this.solve(t,{timeout:60})).solution}async HCaptchaImageTask(t){return(await this.solve(t,{timeout:60})).solution}async recaptcha(t){t={websiteURL:t.url,websiteKey:t.sitekey,type:"RecaptchaV2TaskProxyless"};return(await this.solve(t,{timeout:120})).solution}async antibot(t){var e,a=[],i=[];for(e in t)"main"!==e&&(a.push(t[e]),i.push(e));var s={type:"AntibotCaptchaTask",subType:"0",image:t.main+"|"+a.join("|")};let o=(await this.solve(s,{timeout:60})).solution;o=o.split(",");for(let t=0;t<o.length;t++)o[t]=i[parseInt(o[t])];return o.join(",")}async solve(t,e){t=await this.createTask(t);return this.waitForResult(t,e)}async createTask(t){var e={method:"POST",headers:{"Content-Type":"application/json"}};let a={};a.clientKey=this.clientKey,a.task=t,a=JSON.stringify(a),e.body=a;let i;for(let t=0;t<10;t++){try{(i=await(await fetch(this.endpoints.createTaskApi,e)).json()).errorId=parseInt(i.errorId);break}catch(t){await new Promise(t=>setTimeout(t,3e3+8e3*Math.random()));continue}throw new Error("API_CONNECTION_ERROR")}if(i.errorId!==StatusCode.SUCCESS.code)throw new Error(i.errorDescription);return i.taskId}async waitForResult(t,e){e=e||{timeout:this.defaultTimeout,pollingInterval:this.pollingInterval};var a=this.getTime(),i=void 0===e.timeout?this.defaultTimeout:e.timeout;let s=(void 0===e.pollingInterval?this:e).pollingInterval;for(;;){if(!(this.getTime()-a<i))break;await new Promise(t=>setTimeout(t,1e3*s));try{var o=await this.getTaskResult(t);if(o.errorId===StatusCode.SUCCESS.code)return o}catch(t){throw t}}throw new Error("Timeout "+i+" seconds reached")}async getTaskResult(t){var e={method:"POST",headers:{"Content-Type":"application/json"}};let a={};a.clientKey=this.clientKey,a.taskId=t,a=JSON.stringify(a),e.body=a;let i;for(let t=0;t<10;t++){try{(i=await(await fetch(this.endpoints.getTaskResultApi,e)).json()).errorId=parseInt(i.errorId);break}catch(t){await new Promise(t=>setTimeout(t,1e3));continue}throw new Error("API_CONNECTION_ERROR")}if(i.errorId!==StatusCode.SUCCESS.code&&i.errorId!==StatusCode.PROCESSING.code)throw new Error(i.errorDescription);return i}getTime(){return parseInt(Date.now()/1e3)}}export{AchiCaptcha};
